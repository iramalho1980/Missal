<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordem da Missa</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu Mono', monospace;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2d4a3e 50%, #4a6b5a 75%, #6b8e7a 100%);
            min-height: 100vh;
            padding: 10px;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100vh;
        }

        .main-title {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .main-title h1 {
            color: #f0f0f0;
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 255, 0, 0.4);
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .timer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            background: rgba(0, 0, 0, 0.3);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            min-width: 200px;
            text-align: center;
            letter-spacing: 3px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .timer-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-family: 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 80px;
        }

        .btn-start {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-stop {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-reset {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #000000;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .timer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.2);
        }

        .timer-btn:active {
            transform: translateY(0);
        }

        .timer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Controles de Salvar/Carregar */
        .save-load-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }

        .btn-save {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }

        .btn-load {
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(111, 66, 193, 0.3);
        }

        .quadros-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            overflow: hidden;
        }

        .quadro {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 15px;
            flex: 1;
            min-height: 350px; /* Aumentado para 350px */
            overflow-y: auto;
        }

        /* Estilos para o novo quadro do timer */
        .timer-and-new-controls {
            margin-top: 15px;
            padding: 20px;
            text-align: center;
        }

        .timer-and-new-controls h2 {
            margin-bottom: 20px;
        }

        /* Ajustes para botões em telas menores */
        @media (max-width: 767px) {
            .timer-btn, .btn {
                width: 100%; /* Ocupa a largura total em mobile */
                margin-bottom: 10px; /* Espaçamento entre botões */
            }

            .timer-controls, .save-load-controls, .modal-buttons {
                flex-direction: column; /* Botões empilhados em mobile */
                gap: 0; /* Remove o gap padrão */
            }
        }

        /* Responsivo para mobile */
        @media (min-width: 768px) {
            .quadros-container {
                flex-direction: row;
            }
            
            .quadro {
                flex: 1;
                min-height: 400px;
            }

            .timer-display {
                font-size: 3rem;
            }

            .main-title h1 {
                font-size: 2.2rem;
            }
        }

        /* Animações */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cantico-item {
            animation: fadeIn 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% {
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            50% {
                text-shadow: 0 0 30px rgba(255, 215, 0, 0.9);
            }
        }

        .timer-display.running {
            animation: pulse 2s infinite;
        }

        /* Adicionar cântico flutuante */
        .add-cantico-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffff00, #ffd700);
            color: #000000;
            border: none;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 255, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .add-cantico-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 255, 0, 0.6);
        }

        /* Modal para adicionar cântico */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: #f0f0f0;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #e0e0e0;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'Ubuntu Mono', monospace;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #ffffff;
            font-size: 0.9rem;
            font-family: 'Ubuntu Mono', monospace;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: rgba(255, 255, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control option {
            background: #2a2a2a;
            color: #ffffff;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'Ubuntu Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffff00, #ffd700);
            color: #000000;
            box-shadow: 0 4px 15px rgba(255, 255, 0, 0.3);
        }

        .btn-secondary {
            background: rgba(108, 117, 125, 0.8);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Estilos para lista de configurações salvas */
        .saved-configs-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .config-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-name {
            color: #ffffff;
            font-weight: 700;
        }

        .config-date {
            color: #c0c0c0;
            font-size: 0.8rem;
        }

        .config-actions {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Quadros -->
        <div class="quadros-container">
            <!-- Quadro 1: Lista de Cânticos -->
            <div class="quadro">
                <h2>📋 Lista de Cânticos</h2>
                <div id="listaCanticos" class="lista-canticos">
                    <div class="lista-vazia">Nenhum cântico adicionado ainda</div>
                </div>
            </div>

            <!-- Quadro 2: Cânticos Realizados -->
            <div class="quadro">
                <h2>✅ Realizados</h2>
                <div id="canticosRealizados" class="lista-canticos">
                    <div class="lista-vazia">Nenhum cântico realizado ainda</div>
                </div>
            </div>
        </div>

        <!-- Novo Quadro para Timer e Controles -->
        <div class="quadro timer-and-new-controls">
            <h2>⏱️ Timer e Controles</h2>
            <div class="timer-container">
                <div class="timer-display" id="timerDisplay">00:00:00</div>
                <div class="timer-controls">
                    <button class="timer-btn btn-start" id="startBtn">▶ Start</button>
                    <button class="timer-btn btn-stop" id="stopBtn" disabled>⏸ Stop</button>
                    <button class="timer-btn btn-reset" id="resetBtn">🔄 Reset</button>
                </div>
                <div class="save-load-controls">
                    <button class="timer-btn btn-save" id="saveBtn">💾 Salvar</button>
                    <button class="timer-btn btn-load" id="loadBtn">📂 Carregar</button>
                    <button class="timer-btn btn-new" id="newBtn">✨ Novo</button>
                </div>
            </div>
        </div>

        <!-- Botão flutuante para adicionar cântico -->
        <button class="add-cantico-btn" id="addCanticoBtn">+</button>

        <!-- Modal para adicionar cântico -->
        <div class="modal" id="modalAddCantico">
            <div class="modal-content">
                <h3>➕ Adicionar Cântico</h3>
                <form id="formCantico">
                    <div class="form-group">
                        <label for="tipoCantico">Tipo do Cântico:</label>
                        <select id="tipoCantico" class="form-control" required>
                            <option value="">Selecione o tipo</option>
                            <option value="Entrada">Entrada</option>
                            <option value="Ato Penitencial">Ato Penitencial</option>
                            <option value="Glória">Glória</option>
                            <option value="Salmo Responsorial">Salmo Responsorial</option>
                            <option value="Aclamação ao Evangelho">Aclamação ao Evangelho</option>
                            <option value="Apresentação das Oferendas">Apresentação das Oferendas</option>
                            <option value="Santo">Santo</option>
                            <option value="Cordeiro de Deus">Cordeiro de Deus</option>
                            <option value="Comunhão">Comunhão</option>
                            <option value="Ação de Graças">Ação de Graças</option>
                            <option value="Final">Final</option>
                            <option value="Meditação">Meditação</option>
                            <option value="Adoração">Adoração</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="nomeCantico">Nome do Cântico:</label>
                        <input type="text" id="nomeCantico" class="form-control" placeholder="Digite o nome do cântico" required>
                    </div>

                    <div class="form-group">
                        <label for="tomCantico">Tom:</label>
                        <select id="tomCantico" class="form-control" required>
                            <option value="">Selecione o tom</option>
                            <option value="C">C (Dó Maior)</option>
                            <option value="Cm">Cm (Dó Menor)</option>
                            <option value="C#">C# (Dó sustenido Maior)</option>
                            <option value="C#m">C#m (Dó sustenido Menor)</option>
                            <option value="Db">Db (Ré bemol Maior)</option>
                            <option value="Dbm">Dbm (Ré bemol Menor)</option>
                            <option value="D">D (Ré Maior)</option>
                            <option value="Dm">Dm (Ré Menor)</option>
                            <option value="D#">D# (Ré sustenido Maior)</option>
                            <option value="D#m">D#m (Ré sustenido Menor)</option>
                            <option value="Eb">Eb (Mi bemol Maior)</option>
                            <option value="Ebm">Ebm (Mi bemol Menor)</option>
                            <option value="E">E (Mi Maior)</option>
                            <option value="Em">Em (Mi Menor)</option>
                            <option value="F">F (Fá Maior)</option>
                            <option value="Fm">Fm (Fá Menor)</option>
                            <option value="F#">F# (Fá sustenido Maior)</option>
                            <option value="F#m">F#m (Fá sustenido Menor)</option>
                            <option value="Gb">Gb (Sol bemol Maior)</option>
                            <option value="Gbm">Gbm (Sol bemol Menor)</option>
                            <option value="G">G (Sol Maior)</option>
                            <option value="Gm">Gm (Sol Menor)</option>
                            <option value="G#">G# (Sol sustenido Maior)</option>
                            <option value="G#m">G#m (Sol sustenido Menor)</option>
                            <option value="Ab">Ab (Lá bemol Maior)</option>
                            <option value="Abm">Abm (Lá bemol Menor)</option>
                            <option value="A">A (Lá Maior)</option>
                            <option value="Am">Am (Lá Menor)</option>
                            <option value="A#">A# (Lá sustenido Maior)</option>
                            <option value="A#m">A#m (Lá sustenido Menor)</option>
                            <option value="Bb">Bb (Si bemol Maior)</option>
                            <option value="Bbm">Bbm (Si bemol Menor)</option>
                            <option value="B">B (Si Maior)</option>
                            <option value="Bm">Bm (Si Menor)</option>
                        </select>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Adicionar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para salvar configuração -->
        <div class="modal" id="modalSave">
            <div class="modal-content">
                <h3>💾 Salvar Configuração</h3>
                <form id="formSave">
                    <div class="form-group">
                        <label for="nomeConfiguracao">Nome da Configuração:</label>
                        <input type="text" id="nomeConfiguracao" class="form-control" placeholder="Ex: Missa de Domingo, Natal 2024..." required>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="btn btn-secondary" id="cancelSaveBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para carregar configuração -->
        <div class="modal" id="modalLoad">
            <div class="modal-content">
                <h3>📂 Carregar Configuração</h3>
                <div id="savedConfigsList" class="saved-configs-list">
                    <div class="lista-vazia">Nenhuma configuração salva ainda</div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" id="cancelLoadBtn">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GerenciadorCanticos {
            constructor() {
                this.canticos = [];
                this.realizados = [];
                this.editandoId = null;
                this.timer = {
                    startTime: null,
                    elapsedTime: 0,
                    interval: null,
                    isRunning: false
                };
                this.inicializar();
            }

            inicializar() {
                this.limparDadosAtuais(); // Limpa os dados ao carregar a página
                this.configurarEventos();
                this.atualizarListas();
                this.atualizarTimer();
            }

            configurarEventos() {
                // Eventos do formulário
                const form = document.getElementById("formCantico");
                form.addEventListener("submit", (e) => this.adicionarCantico(e));

                // Eventos do modal
                const addBtn = document.getElementById("addCanticoBtn");
                const modal = document.getElementById("modalAddCantico");
                const cancelBtn = document.getElementById("cancelBtn");

                addBtn.addEventListener("click", () => this.abrirModal());
                cancelBtn.addEventListener("click", () => this.fecharModal());
                modal.addEventListener("click", (e) => {
                    if (e.target === modal) this.fecharModal();
                });

                // Eventos do timer
                const startBtn = document.getElementById("startBtn");
                const stopBtn = document.getElementById("stopBtn");
                const resetBtn = document.getElementById("resetBtn");

                startBtn.addEventListener("click", () => this.iniciarTimer());
                stopBtn.addEventListener("click", () => this.pararTimer());
                resetBtn.addEventListener("click", () => this.resetarTimer());

                // Eventos de salvar/carregar
                const saveBtn = document.getElementById("saveBtn");
                const loadBtn = document.getElementById("loadBtn");
                const newBtn = document.getElementById("newBtn"); // Novo botão
                const modalSave = document.getElementById("modalSave");
                const modalLoad = document.getElementById("modalLoad");
                const formSave = document.getElementById("formSave");
                const cancelSaveBtn = document.getElementById("cancelSaveBtn");
                const cancelLoadBtn = document.getElementById("cancelLoadBtn");

                saveBtn.addEventListener("click", () => this.abrirModalSalvar());
                loadBtn.addEventListener("click", () => this.abrirModalCarregar());
                newBtn.addEventListener("click", () => this.novaOrdem()); // Evento para o novo botão
                formSave.addEventListener("submit", (e) => this.salvarConfiguracao(e));
                cancelSaveBtn.addEventListener("click", () => this.fecharModalSalvar());
                cancelLoadBtn.addEventListener("click", () => this.fecharModalCarregar());

                modalSave.addEventListener("click", (e) => {
                    if (e.target === modalSave) this.fecharModalSalvar();
                });

                modalLoad.addEventListener("click", (e) => {
                    if (e.target === modalLoad) this.fecharModalCarregar();
                });

                // Configurar drag and drop
                const listaCanticos = document.getElementById("listaCanticos");
                listaCanticos.addEventListener("dragover", (e) => this.permitirDrop(e));
                listaCanticos.addEventListener("drop", (e) => this.reorganizarCanticos(e));

                // Evento para limpar dados ao fechar o navegador
                window.addEventListener("beforeunload", () => {
                    this.limparDadosAtuais();
                });
            }

            novaOrdem() {
                if (confirm("Tem certeza que deseja iniciar uma nova ordem? A ordem atual será perdida se não for salva.")) {
                    this.limparDadosAtuais();
                    alert("Nova ordem iniciada!");
                }
            }

            limparDadosAtuais() {
                localStorage.removeItem("canticos");
                localStorage.removeItem("realizados");
                localStorage.removeItem("timer");
                this.canticos = [];
                this.realizados = [];
                this.timer.elapsedTime = 0;
                this.pararTimer();
                this.atualizarListas();
                this.atualizarTimer();
            }

            // Métodos do Timer
            iniciarTimer() {
                if (!this.timer.isRunning) {
                    this.timer.startTime = Date.now() - this.timer.elapsedTime;
                    this.timer.interval = setInterval(() => this.atualizarTimer(), 100);
                    this.timer.isRunning = true;
                    
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('timerDisplay').classList.add('running');
                }
            }

            pararTimer() {
                if (this.timer.isRunning) {
                    clearInterval(this.timer.interval);
                    this.timer.isRunning = false;
                    
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    document.getElementById('timerDisplay').classList.remove('running');
                }
            }

            resetarTimer() {
                this.pararTimer();
                this.timer.elapsedTime = 0;
                this.atualizarTimer();
            }

            atualizarTimer() {
                if (this.timer.isRunning) {
                    this.timer.elapsedTime = Date.now() - this.timer.startTime;
                }

                const totalSeconds = Math.floor(this.timer.elapsedTime / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timerDisplay').textContent = display;
            }

            // Métodos do Modal
            abrirModal() {
                document.getElementById('modalAddCantico').classList.add('show');
            }

            fecharModal() {
                document.getElementById('modalAddCantico').classList.remove('show');
                this.limparFormulario();
            }

            // Métodos de Salvar/Carregar
            abrirModalSalvar() {
                document.getElementById('modalSave').classList.add('show');
            }

            fecharModalSalvar() {
                document.getElementById('modalSave').classList.remove('show');
                document.getElementById('nomeConfiguracao').value = '';
            }

            abrirModalCarregar() {
                this.atualizarListaConfiguracoes();
                document.getElementById('modalLoad').classList.add('show');
            }

            fecharModalCarregar() {
                document.getElementById('modalLoad').classList.remove('show');
            }

            salvarConfiguracao(e) {
                e.preventDefault();
                
                const nome = document.getElementById('nomeConfiguracao').value.trim();
                if (!nome) {
                    alert('Por favor, digite um nome para a configuração!');
                    return;
                }

                const configuracao = {
                    id: Date.now(),
                    nome: nome,
                    data: new Date().toLocaleString('pt-BR'),
                    canticos: [...this.canticos],
                    realizados: [...this.realizados],
                    timer: {
                        elapsedTime: this.timer.elapsedTime,
                        isRunning: false // Sempre salva com timer parado
                    }
                };

                // Salvar no banco de dados local
                this.salvarConfiguracaoNoBanco(configuracao);
                
                alert(`Configuração "${nome}" salva com sucesso!`);
                this.fecharModalSalvar();
            }

            salvarConfiguracaoNoBanco(configuracao) {
                let configuracoesSalvas = JSON.parse(localStorage.getItem('configuracoesSalvas') || '[]');
                
                // Verificar se já existe uma configuração com o mesmo nome
                const indiceExistente = configuracoesSalvas.findIndex(c => c.nome === configuracao.nome);
                
                if (indiceExistente !== -1) {
                    if (confirm(`Já existe uma configuração com o nome "${configuracao.nome}". Deseja substituir?`)) {
                        configuracoesSalvas[indiceExistente] = configuracao;
                    } else {
                        return;
                    }
                } else {
                    configuracoesSalvas.push(configuracao);
                }
                
                localStorage.setItem('configuracoesSalvas', JSON.stringify(configuracoesSalvas));
            }

            carregarConfiguracao(id) {
                const configuracoesSalvas = JSON.parse(localStorage.getItem('configuracoesSalvas') || '[]');
                const configuracao = configuracoesSalvas.find(c => c.id === id);
                
                if (configuracao) {
                    // Parar timer atual
                    this.pararTimer();
                    
                    // Carregar dados
                    this.canticos = [...configuracao.canticos];
                    this.realizados = [...configuracao.realizados];
                    this.timer.elapsedTime = configuracao.timer.elapsedTime || 0;
                    
                    // Atualizar interface
                    this.atualizarListas();
                    this.atualizarTimer();
                    
                    alert(`Configuração "${configuracao.nome}" carregada com sucesso!`);
                    this.fecharModalCarregar();
                }
            }

            excluirConfiguracao(id) {
                let configuracoesSalvas = JSON.parse(localStorage.getItem('configuracoesSalvas') || '[]');
                const configuracao = configuracoesSalvas.find(c => c.id === id);
                
                if (configuracao && confirm(`Tem certeza que deseja excluir a configuração "${configuracao.nome}"?`)) {
                    configuracoesSalvas = configuracoesSalvas.filter(c => c.id !== id);
                    localStorage.setItem('configuracoesSalvas', JSON.stringify(configuracoesSalvas));
                    this.atualizarListaConfiguracoes();
                }
            }

            atualizarListaConfiguracoes() {
                const configuracoesSalvas = JSON.parse(localStorage.getItem('configuracoesSalvas') || '[]');
                const lista = document.getElementById('savedConfigsList');
                
                if (configuracoesSalvas.length === 0) {
                    lista.innerHTML = '<div class="lista-vazia">Nenhuma configuração salva ainda</div>';
                } else {
                    lista.innerHTML = '';
                    configuracoesSalvas.forEach(config => {
                        const div = document.createElement('div');
                        div.className = 'config-item';
                        div.innerHTML = `
                            <div>
                                <div class="config-name">${config.nome}</div>
                                <div class="config-date">${config.data}</div>
                            </div>
                            <div class="config-actions">
                                <button class="btn-small btn-edit" onclick="gerenciador.carregarConfiguracao(${config.id})">📂 Carregar</button>
                                <button class="btn-small btn-delete" onclick="gerenciador.excluirConfiguracao(${config.id})">🗑️</button>
                            </div>
                        `;
                        lista.appendChild(div);
                    });
                }
            }

            adicionarCantico(e) {
                e.preventDefault();
                
                const tipo = document.getElementById('tipoCantico').value;
                const nome = document.getElementById('nomeCantico').value;
                const tom = document.getElementById('tomCantico').value;

                if (!tipo || !nome || !tom) {
                    alert('Por favor, preencha todos os campos!');
                    return;
                }

                const cantico = {
                    id: this.editandoId || Date.now(),
                    tipo,
                    nome,
                    tom
                };

                if (this.editandoId) {
                    const index = this.canticos.findIndex(c => c.id === this.editandoId);
                    this.canticos[index] = cantico;
                    this.editandoId = null;
                } else {
                    this.canticos.push(cantico);
                }

                this.salvarDados();
                this.atualizarListas();
                this.fecharModal();
            }

            editarCantico(id) {
                const cantico = this.canticos.find(c => c.id === id);
                if (cantico) {
                    document.getElementById('tipoCantico').value = cantico.tipo;
                    document.getElementById('nomeCantico').value = cantico.nome;
                    document.getElementById('tomCantico').value = cantico.tom;
                    this.editandoId = id;
                    
                    const btn = document.querySelector('.btn-primary');
                    btn.textContent = 'Atualizar';
                    this.abrirModal();
                }
            }

            excluirCantico(id) {
                if (confirm('Tem certeza que deseja excluir este cântico?')) {
                    this.canticos = this.canticos.filter(c => c.id !== id);
                    this.salvarDados();
                    this.atualizarListas();
                }
            }

            marcarRealizado(id) {
                const cantico = this.canticos.find(c => c.id === id);
                if (cantico) {
                    this.realizados.push(cantico);
                    this.canticos = this.canticos.filter(c => c.id !== id);
                    this.salvarDados();
                    this.atualizarListas();
                }
            }

            voltarParaLista(id) {
                const cantico = this.realizados.find(c => c.id === id);
                if (cantico) {
                    this.canticos.push(cantico);
                    this.realizados = this.realizados.filter(c => c.id !== id);
                    this.salvarDados();
                    this.atualizarListas();
                }
            }

            permitirDrop(e) {
                e.preventDefault();
                e.currentTarget.classList.add('drag-over');
            }

            reorganizarCanticos(e) {
                e.preventDefault();
                e.currentTarget.classList.remove('drag-over');
                
                const draggedId = parseInt(e.dataTransfer.getData('text/plain'));
                const dropTarget = e.target.closest('.cantico-item');
                
                if (dropTarget && draggedId) {
                    const draggedIndex = this.canticos.findIndex(c => c.id === draggedId);
                    const targetId = parseInt(dropTarget.dataset.id);
                    const targetIndex = this.canticos.findIndex(c => c.id === targetId);
                    
                    if (draggedIndex !== -1 && targetIndex !== -1) {
                        const [draggedItem] = this.canticos.splice(draggedIndex, 1);
                        this.canticos.splice(targetIndex, 0, draggedItem);
                        this.salvarDados();
                        this.atualizarListas();
                    }
                }
            }

            criarElementoCantico(cantico, isRealizado = false) {
                const div = document.createElement('div');
                div.className = `cantico-item ${isRealizado ? 'realizado' : ''}`;
                div.dataset.id = cantico.id;
                div.draggable = !isRealizado;

                if (!isRealizado) {
                    div.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', cantico.id);
                        div.classList.add('dragging');
                    });

                    div.addEventListener('dragend', () => {
                        div.classList.remove('dragging');
                    });

                    div.addEventListener('click', () => this.marcarRealizado(cantico.id));
                } else {
                    div.addEventListener('click', () => this.voltarParaLista(cantico.id));
                }

                div.innerHTML = `
                    <div class="cantico-info">
                        <div class="cantico-tipo">${cantico.tipo}</div>
                        <div class="cantico-nome">${cantico.nome}</div>
                        <div class="cantico-tom">Tom: ${cantico.tom}</div>
                    </div>
                    ${!isRealizado ? `
                        <div class="cantico-actions">
                            <button class="btn-small btn-edit" onclick="event.stopPropagation(); gerenciador.editarCantico(${cantico.id})">✏️</button>
                            <button class="btn-small btn-delete" onclick="event.stopPropagation(); gerenciador.excluirCantico(${cantico.id})">🗑️</button>
                        </div>
                    ` : ''}
                `;

                return div;
            }

            atualizarListas() {
                const listaCanticos = document.getElementById('listaCanticos');
                const canticosRealizados = document.getElementById('canticosRealizados');

                // Atualizar lista de cânticos
                if (this.canticos.length === 0) {
                    listaCanticos.innerHTML = '<div class="lista-vazia">Nenhum cântico adicionado ainda</div>';
                } else {
                    listaCanticos.innerHTML = '';
                    this.canticos.forEach(cantico => {
                        listaCanticos.appendChild(this.criarElementoCantico(cantico));
                    });
                }

                // Atualizar lista de realizados
                if (this.realizados.length === 0) {
                    canticosRealizados.innerHTML = '<div class="lista-vazia">Nenhum cântico realizado ainda</div>';
                } else {
                    canticosRealizados.innerHTML = '';
                    this.realizados.forEach(cantico => {
                        canticosRealizados.appendChild(this.criarElementoCantico(cantico, true));
                    });
                }
            }

            limparFormulario() {
                document.getElementById('formCantico').reset();
                this.editandoId = null;
                const btn = document.querySelector('.btn-primary');
                btn.textContent = 'Adicionar';
            }

            salvarDados() {
                localStorage.setItem('canticos', JSON.stringify(this.canticos));
                localStorage.setItem('realizados', JSON.stringify(this.realizados));
                localStorage.setItem('timer', JSON.stringify({
                    elapsedTime: this.timer.elapsedTime,
                    isRunning: this.timer.isRunning
                }));
            }

            carregarDados() {
                const canticos = localStorage.getItem('canticos');
                const realizados = localStorage.getItem('realizados');
                const timer = localStorage.getItem('timer');
                
                if (canticos) {
                    this.canticos = JSON.parse(canticos);
                }
                
                if (realizados) {
                    this.realizados = JSON.parse(realizados);
                }

                if (timer) {
                    const timerData = JSON.parse(timer);
                    this.timer.elapsedTime = timerData.elapsedTime || 0;
                    if (timerData.isRunning) {
                        // Se estava rodando, continua do ponto onde parou
                        this.iniciarTimer();
                    }
                }
            }
        }

        // Inicializar o gerenciador quando a página carregar
        let gerenciador;
        document.addEventListener('DOMContentLoaded', () => {
            gerenciador = new GerenciadorCanticos();
        });
    </script>
</body>
</html>

